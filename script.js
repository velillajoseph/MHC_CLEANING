const translations = {
  es: {
    navServices: "Servicios",
    navAbout: "Nosotros",
    navContact: "Contacto",
    headerContactCta: "Contáctanos",
    heroHeadline: "Servicios de limpieza profesionales en los que puedes confiar",
    heroSubheadline: "Cotización gratis. Respuesta rápida. Servicio confiable.",
    heroTagline: "¡Tu espacio, nuestro cuidado!",
    heroPrimaryCta: "Solicitar cotización gratis por WhatsApp",
    heroSecondaryCta: "Llamar ahora",
    trustFree: "Cotización gratis",
    trustFast: "Respuesta rápida",
    trustQuality: "Enfoque en calidad",
    heroMediaTitle: "Signature Care",
    heroMediaSubtitle: "Detalles premium para hogares y alquileres.",
    servicesTitle: "Servicios",
    servicesIntro: "Soluciones flexibles para hogares, alquileres y negocios.",
    service1Title: "Limpieza Residencial",
    service1Body: "Mantén tu hogar impecable con planes adaptados a tu rutina.",
    service2Title: "Limpieza Profunda",
    service2Body: "Atención al detalle para dejar cada espacio como nuevo.",
    service3Title: "Airbnb / Short-Term Rental",
    service3Body: "Preparación rápida y confiable para tus huéspedes.",
    service4Title: "Limpieza Comercial",
    service4Body:
      "Espacios de trabajo limpios que generan confianza en tu equipo y clientes.",
    aboutTitle: "Sobre MHC Cleaning",
    aboutBody1:
      "En MHC Cleaning cuidamos cada detalle para que disfrutes de un ambiente limpio y saludable. Nuestro equipo se adapta a tus necesidades con un trato profesional y respetuoso.",
    aboutBody2:
      "Desde hogares hasta negocios, trabajamos con consistencia y comunicación clara para que siempre sepas qué esperar.",
    contactEyebrow: "Atención concierge",
    contactTitle: "Contacto",
    contactIntro: "Un servicio impecable comienza con una conversación discreta y personalizada.",
    contactMainTitle: "Diseñemos tu rutina de limpieza",
    contactMainBody:
      "Cuéntanos sobre tu espacio y crearemos un plan premium con acabados perfectos, tiempos flexibles y atención bilingüe.",
    contactPrimaryCta: "Solicitar cotización por WhatsApp",
    contactSecondaryCta: "Llamar a un asesor",
    contactTertiaryCta: "Enviar correo",
    contactNote: "Respondemos en menos de 2 horas hábiles.",
    contactDirectLabel: "Línea directa",
    contactDirectHelper: "Atención en español e inglés.",
    contactHoursLabel: "Horario premium",
    contactHoursValue: "Domingo a Sábado · 8:00 AM – 6:00 PM",
    contactHoursHelper: "Disponibilidad para limpiezas urgentes.",
    contactLocationLabel: "Zona de servicio",
    contactLocationValue: "Puerto Rico · Residencial, comercial y Airbnb.",
    contactLocationHelper: "Cobertura flexible para cada necesidad.",
    contactSignatureTitle: "Experiencia Signature",
    contactSignatureBody:
      "Un equipo discreto, uniformado y atento. Seleccionamos productos premium y dejamos cada espacio listo para impresionar.",
    contactChip1: "Planes semanales",
    contactChip2: "Checklists digitales",
    contactChip3: "Control de calidad",
    footerTagline: "Limpieza premium con acabados impecables.",
    footerServicesTitle: "Servicios",
    footerService1: "Residencial",
    footerService2: "Limpieza profunda",
    footerService3: "Airbnb y alquileres",
    footerService4: "Comercial",
    footerContactTitle: "Contacto",
    footerContactNote: "Atención bilingüe · PR",
    footerHoursTitle: "Horario",
    footerHoursValue: "Domingo a Sábado · 8:00 AM – 6:00 PM",
    footerHoursNote: "Citas especiales bajo solicitud.",
    footerCopyright: "© 2024 MHC Cleaning. Todos los derechos reservados.",
    modalTitle: "Cotización por WhatsApp",
    modalSubtitle: "Completa los detalles para preparar tu mensaje.",
    modalFieldLocation: "Localidad de servicio",
    modalFieldCity: "Ubicación",
    modalFieldServiceType: "Tipo de servicio",
    modalSubmit: "Abrir WhatsApp",
    selectPlaceholder: "Selecciona una opción",
    formHint: "Completa todos los campos para continuar.",
    serviceLocationOptions: ["Airbnb", "Residencia", "Comercial"],
    serviceTypeOptions: ["Limpieza Regular", "Limpieza Profunda"],
  },
  en: {
    navServices: "Services",
    navAbout: "About",
    navContact: "Contact",
    headerContactCta: "Contact Us",
    heroHeadline: "Professional Cleaning Services You Can Trust",
    heroSubheadline: "Free quotes. Fast response. Reliable service.",
    heroTagline: "Your space, our care.",
    heroPrimaryCta: "Request a Free Quote on WhatsApp",
    heroSecondaryCta: "Call Now",
    trustFree: "Free quotes",
    trustFast: "Fast response",
    trustQuality: "Quality-focused",
    heroMediaTitle: "Signature Care",
    heroMediaSubtitle: "Premium detailing for homes and rentals.",
    servicesTitle: "Services",
    servicesIntro: "Flexible solutions for homes, rentals, and businesses.",
    service1Title: "Residential Cleaning",
    service1Body: "Keep your home spotless with plans tailored to your routine.",
    service2Title: "Deep Cleaning",
    service2Body: "Detail-focused care to refresh every space.",
    service3Title: "Airbnb / Short-Term Rental",
    service3Body: "Quick, reliable turnovers for your guests.",
    service4Title: "Commercial Cleaning",
    service4Body: "Clean workspaces that build trust with teams and clients.",
    aboutTitle: "About MHC Cleaning",
    aboutBody1:
      "At MHC Cleaning we care for every detail so you can enjoy a clean and healthy environment. Our team adapts to your needs with professional, respectful service.",
    aboutBody2:
      "From homes to businesses, we deliver consistent results with clear communication so you always know what to expect.",
    contactEyebrow: "Concierge service",
    contactTitle: "Contact",
    contactIntro: "An impeccable service begins with a discreet, personalized conversation.",
    contactMainTitle: "Let’s design your cleaning rhythm",
    contactMainBody:
      "Share your space details and we will craft a premium plan with flawless finishes, flexible timing, and bilingual care.",
    contactPrimaryCta: "Request a WhatsApp quote",
    contactSecondaryCta: "Call an advisor",
    contactTertiaryCta: "Send an email",
    contactNote: "We respond within 2 business hours.",
    contactDirectLabel: "Direct line",
    contactDirectHelper: "Service in English and Spanish.",
    contactHoursLabel: "Premium hours",
    contactHoursValue: "Sunday to Saturday · 8:00 AM – 6:00 PM",
    contactHoursHelper: "Availability for urgent cleanings.",
    contactLocationLabel: "Service area",
    contactLocationValue: "Puerto Rico · Residential, commercial, and Airbnb.",
    contactLocationHelper: "Flexible coverage for every need.",
    contactSignatureTitle: "Signature experience",
    contactSignatureBody:
      "A discreet, uniformed, attentive team. We select premium products and leave every space ready to impress.",
    contactChip1: "Weekly plans",
    contactChip2: "Digital checklists",
    contactChip3: "Quality control",
    footerTagline: "Premium cleaning with flawless finishes.",
    footerServicesTitle: "Services",
    footerService1: "Residential",
    footerService2: "Deep cleaning",
    footerService3: "Airbnb & rentals",
    footerService4: "Commercial",
    footerContactTitle: "Contact",
    footerContactNote: "Bilingual service · PR",
    footerHoursTitle: "Hours",
    footerHoursValue: "Sunday to Saturday · 8:00 AM – 6:00 PM",
    footerHoursNote: "Special appointments upon request.",
    footerCopyright: "© 2024 MHC Cleaning. All rights reserved.",
    modalTitle: "WhatsApp Quote",
    modalSubtitle: "Complete the details to prepare your message.",
    modalFieldLocation: "Service location",
    modalFieldCity: "Location",
    modalFieldServiceType: "Service type",
    modalSubmit: "Open WhatsApp",
    selectPlaceholder: "Select an option",
    formHint: "Please complete all fields to continue.",
    serviceLocationOptions: ["Airbnb", "Residential", "Commercial"],
    serviceTypeOptions: ["Regular Cleaning", "Deep Cleaning"],
  },
};

const municipalities = [
  "Adjuntas",
  "Aguada",
  "Aguadilla",
  "Aguas Buenas",
  "Aibonito",
  "Añasco",
  "Arecibo",
  "Arroyo",
  "Barceloneta",
  "Barranquitas",
  "Bayamón",
  "Cabo Rojo",
  "Caguas",
  "Camuy",
  "Canóvanas",
  "Carolina",
  "Cataño",
  "Cayey",
  "Ceiba",
  "Ciales",
  "Cidra",
  "Coamo",
  "Comerío",
  "Corozal",
  "Culebra",
  "Dorado",
  "Fajardo",
  "Florida",
  "Guánica",
  "Guayama",
  "Guayanilla",
  "Guaynabo",
  "Gurabo",
  "Hatillo",
  "Hormigueros",
  "Humacao",
  "Isabela",
  "Jayuya",
  "Juana Díaz",
  "Juncos",
  "Lajas",
  "Lares",
  "Las Marías",
  "Las Piedras",
  "Loíza",
  "Luquillo",
  "Manatí",
  "Maricao",
  "Maunabo",
  "Mayagüez",
  "Moca",
  "Morovis",
  "Naguabo",
  "Naranjito",
  "Orocovis",
  "Patillas",
  "Peñuelas",
  "Ponce",
  "Quebradillas",
  "Rincón",
  "Río Grande",
  "Sabana Grande",
  "Salinas",
  "San Germán",
  "San Juan",
  "San Lorenzo",
  "San Sebastián",
  "Santa Isabel",
  "Toa Alta",
  "Toa Baja",
  "Trujillo Alto",
  "Utuado",
  "Vega Alta",
  "Vega Baja",
  "Vieques",
  "Villalba",
  "Yabucoa",
  "Yauco",
];

const modalOverlay = document.querySelector(".modal-overlay");
const modal = document.querySelector(".modal");
const openModalButtons = document.querySelectorAll(".open-modal");
const closeModalButton = document.querySelector(".modal-close");
const form = document.querySelector(".modal-form");
const submitButton = form.querySelector('button[type="submit"]');
const hint = form.querySelector(".form-hint");
const siteHeader = document.querySelector(".site-header");
const menuToggle = document.querySelector(".menu-toggle");
const headerPanel = document.querySelector(".header-panel");
const navLinks = document.querySelectorAll(".nav-link");
const stickyShell = document.querySelector(".sticky-shell");
const sections = document.querySelectorAll("section");
const floatingWhatsappButton = document.querySelector(".floating-whatsapp");

const serviceLocationSelect = form.querySelector('select[name="serviceLocation"]');
const municipalitySelect = form.querySelector('select[name="municipality"]');
const serviceTypeSelect = form.querySelector('select[name="serviceType"]');

const langButtons = document.querySelectorAll(".lang-btn");

let currentLanguage = localStorage.getItem("mhcLanguage") || "es";
let lastFocusedElement = null;
let menuOpen = false;

const setTextContent = (key) => {
  document.querySelectorAll(`[data-i18n="${key}"]`).forEach((node) => {
    node.textContent = translations[currentLanguage][key];
  });
};

const populateSelect = (select, options) => {
  const placeholder = translations[currentLanguage].selectPlaceholder;
  select.innerHTML = `<option value="">${placeholder}</option>`;
  options.forEach((option) => {
    const opt = document.createElement("option");
    opt.value = option;
    opt.textContent = option;
    select.appendChild(opt);
  });
};

const updateDocumentTitle = (lang) => {
  document.title =
    lang === "es"
      ? "MHC Cleaning — ¡Tu espacio, nuestro cuidado!"
      : "MHC Cleaning — Your space, our care.";
};

const updateLanguage = () => {
  document.documentElement.lang = currentLanguage;
  updateDocumentTitle(currentLanguage);
  Object.keys(translations[currentLanguage]).forEach((key) => {
    if (typeof translations[currentLanguage][key] === "string") {
      setTextContent(key);
    }
  });

  populateSelect(serviceLocationSelect, translations[currentLanguage].serviceLocationOptions);
  populateSelect(serviceTypeSelect, translations[currentLanguage].serviceTypeOptions);

  const municipalityValue = municipalitySelect.value;
  populateSelect(municipalitySelect, municipalities);
  if (municipalityValue) {
    municipalitySelect.value = municipalityValue;
  }

  langButtons.forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.lang === currentLanguage);
  });

  if (floatingWhatsappButton) {
    floatingWhatsappButton.setAttribute(
      "aria-label",
      currentLanguage === "es" ? "Abrir WhatsApp" : "Open WhatsApp"
    );
  }

  validateForm();
};

const openModal = (trigger) => {
  lastFocusedElement = trigger;
  modalOverlay.classList.add("active");
  document.body.style.overflow = "hidden";
  serviceLocationSelect.focus();
};

const closeModal = () => {
  modalOverlay.classList.remove("active");
  document.body.style.overflow = "";
  if (lastFocusedElement) {
    lastFocusedElement.focus();
  }
};

const updateMenuState = (open) => {
  menuOpen = open;
  siteHeader.classList.toggle("menu-open", menuOpen);
  menuToggle.setAttribute("aria-expanded", menuOpen ? "true" : "false");
};

const closeMenu = () => {
  if (menuOpen) {
    updateMenuState(false);
  }
};

const updateScrollMargins = () => {
  if (!stickyShell) {
    return;
  }
  const offset = stickyShell.offsetHeight + 16;
  document.querySelectorAll("section[id], main[id]").forEach((section) => {
    section.style.scrollMarginTop = `${offset}px`;
  });
};

const validateForm = () => {
  const isValid =
    serviceLocationSelect.value && municipalitySelect.value && serviceTypeSelect.value;
  submitButton.disabled = !isValid;
  hint.textContent = isValid ? "" : translations[currentLanguage].formHint;
  return isValid;
};

const buildMessage = () => {
  const location = serviceLocationSelect.value;
  const municipality = municipalitySelect.value;
  const serviceType = serviceTypeSelect.value;

  if (currentLanguage === "es") {
    return `¡Hola! Me gustaría solicitar una cotización de MHC Cleaning.

Localidad de servicio: ${location}
Ubicación: ${municipality}
Tipo de servicio: ${serviceType}

Por favor, déjenme saber su disponibilidad. ¡Gracias!`;
  }

  return `Hello! I would like to request a quote from MHC Cleaning.

Service location: ${location}
Location: ${municipality}
Service type: ${serviceType}

Please let me know your availability. Thank you!`;
};

openModalButtons.forEach((btn) => {
  btn.addEventListener("click", () => openModal(btn));
});

menuToggle.addEventListener("click", () => updateMenuState(!menuOpen));

closeModalButton.addEventListener("click", closeModal);
modalOverlay.addEventListener("click", (event) => {
  if (!modal.contains(event.target)) {
    closeModal();
  }
});

document.addEventListener("keydown", (event) => {
  if (event.key === "Escape" && modalOverlay.classList.contains("active")) {
    closeModal();
  }
  if (event.key === "Escape" && menuOpen) {
    closeMenu();
  }
});

document.addEventListener("click", (event) => {
  if (!menuOpen) {
    return;
  }

  if (!siteHeader.contains(event.target)) {
    closeMenu();
  }
});

form.addEventListener("input", validateForm);

form.addEventListener("submit", (event) => {
  event.preventDefault();
  if (!validateForm()) {
    return;
  }

  const message = buildMessage();
  const url = `https://wa.me/19392573875?text=${encodeURIComponent(message)}`;
  window.open(url, "_blank", "noopener");
});

langButtons.forEach((btn) => {
  btn.addEventListener("click", () => {
    currentLanguage = btn.dataset.lang;
    localStorage.setItem("mhcLanguage", currentLanguage);
    updateLanguage();
  });
});

navLinks.forEach((link) => {
  link.addEventListener("click", (event) => {
    const href = link.getAttribute("href");
    if (href && href.startsWith("#")) {
      const target = document.querySelector(href);
      if (target) {
        event.preventDefault();
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }
    closeMenu();
  });
});

window.addEventListener("resize", () => {
  updateScrollMargins();
  if (window.innerWidth >= 768) {
    closeMenu();
  }
});

updateLanguage();
updateScrollMargins();

if (sections.length) {
  const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  sections.forEach((section) => section.classList.add("reveal"));

  if (prefersReducedMotion) {
    sections.forEach((section) => section.classList.add("is-visible"));
  } else {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          entry.target.classList.toggle("is-visible", entry.isIntersecting);
        });
      },
      {
        threshold: 0.2,
      }
    );

    sections.forEach((section) => observer.observe(section));
  }
}
